<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garcler</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kenia&display=swap" rel="stylesheet">
    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <img id="startButton" class="button" src="img/Frame 3.svg">
    <img id="stopButton" style="display: none;" class="button" src="img/Frame 3.svg">
    
    <div id="snowContainer"></div>
    

    <div class="container">
        <header class="header">
            <img class="header_title" src="img/Group 6.svg">
        </header>
        <main class="main">
            <div class="main_container">
                <div class="main_block playing_field">
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>
                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>

                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>
                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>

                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>
                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>

                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>
                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>

                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>
                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>
                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">
                    </div>

                    <div class="playing_field_block">
                        <div class="playing_field_block_animate"></div>

                        <img src="img/алмаз.svg" alt="Diamond">

                    
                    </div>
                </div>
                <div class="slider">
                    <div class="slider-button" onclick="prevSlide()"><img src="img/стрелка влево.svg" alt="<"></div>
                    <div class="slider-content">
                        <div class="number" id="slider-number">3</div>
                        <div class="label">ловушек</div>
                    </div>
                    <div class="slider-button" onclick="nextSlide()"><img src="img/стрелка вправо.svg" alt=">"></div>
                </div>
                
                <button class="custom-button" id="start-button">старт</button>
                

                
            </div>
        </main>
    </div>


    <script>


        let snowfallInterval;

        document.getElementById('startButton').addEventListener('click', (event) => {
            event.preventDefault(); // Предотвращаем стандартное поведение кнопки
            startSnowfall();
        });
        document.getElementById('stopButton').addEventListener('click', (event) => {
            event.preventDefault(); // Предотвращаем стандартное поведение кнопки
            stopSnowfall();
        });

        function startSnowfall() {
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('stopButton').style.display = 'block';

            snowfallInterval = setInterval(() => {
                createSnowflake(document.getElementById('snowContainer'));
            }, 70); // Создаем новую снежинку каждые 50 мс для большего количества снега
        }

        function stopSnowfall() {
            clearInterval(snowfallInterval);
            document.getElementById('startButton').style.display = 'block';
            document.getElementById('stopButton').style.display = 'none';
        }

        function createSnowflake(container) {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');

            // Устанавливаем случайные размеры и позиции
            const size = Math.random() * 5 + 2; // Размер от 2 до 7 пикселей
            snowflake.style.width = `${size}px`;
            snowflake.style.height = `${size}px`;
            snowflake.style.left = `${Math.random() * 100}vw`; // Случайная позиция по ширине
            snowflake.style.opacity = Math.random(); // Случайная прозрачность

            container.appendChild(snowflake);

            // Анимация падения с эффектом ветра
            animateSnowflake(snowflake);
        }

        function animateSnowflake(snowflake) {
            const fallDuration = Math.random() * 3 + 2; // Случайная продолжительность падения от 2 до 5 секунд
            const fallDistance = window.innerHeight + 50; // Падение ниже видимой области
            const windEffect = (Math.random() - 0.5) * 100; // Случайное смещение по горизонтали

            snowflake.animate([
                { transform: `translateY(0) translateX(0)` },
                { transform: `translateY(${fallDistance}px) translateX(${windEffect}px)` }
            ], {
                duration: fallDuration * 3500,
                easing: 'linear',
                fill: 'forwards'
            });

            // Удаляем снежинку после падения
            setTimeout(() => {
                snowflake.remove();
            }, fallDuration * 3500);
        }

        const values = [1, 3, 5, 7]; // Возможные значения ловушек
        let currentIndex = 0; // Индекс текущего значения
        const slider = document.getElementById('slider-number');
        const fieldBlocks = document.querySelectorAll('.playing_field_block'); // Все клетки
        let isAnimating = false;

        function updateCounter() {
            slider.textContent = values[currentIndex];
        }

        function prevSlide() {
            if (currentIndex > 0) {
                currentIndex--;
            }
            updateCounter();
        }

        function nextSlide() {
            if (currentIndex < values.length - 1) {
                currentIndex++;
            }
            updateCounter();
        }

        // Логика для кнопки "старт"
        const startBtn = document.querySelector('.custom-button');
        startBtn.addEventListener('click', () => {
            if (isAnimating) return; // Если анимация ещё идёт, игнорируем нажатие

            isAnimating = true; // Блокируем повторное нажатие
            startBtn.setAttribute('disabled', true); // Отключаем кнопку
            const trapCount = values[currentIndex]; // Текущее количество ловушек
            const openCount = trapCount === 1 ? 10 : trapCount === 3 ? 5 : trapCount === 5 ? 4 : 3; // Количество клеток
            const randomIndexes = [];

            // Генерируем уникальные случайные индексы для открытия клеток
            while (randomIndexes.length < openCount) {
                const randomIndex = Math.floor(Math.random() * fieldBlocks.length);
                if (!randomIndexes.includes(randomIndex)) {
                    randomIndexes.push(randomIndex);
                }
            }

            // Сбрасываем ранее открытые клетки
            fieldBlocks.forEach(block => {
                block.classList.remove('open');
                const img = block.querySelector('img');
                img.style.opacity = '0';
                img.style.transform = 'scale(0)';
            });

            // Анимация открытия клеток
            randomIndexes.forEach((index, i) => {
                setTimeout(() => {
                    const block = fieldBlocks[index];
                    block.classList.add('open');
                    setTimeout(() => {
                        const img = block.querySelector('img');
                        img.style.opacity = '1';
                        img.style.transform = 'scale(1)';
                    }, 600);
                }, i * 600);
            });

            const totalAnimationTime = randomIndexes.length * 600 + 600;

            setTimeout(() => {
                isAnimating = false; // Разрешаем нажатие
                startBtn.removeAttribute('disabled'); // Активируем кнопку
            }, totalAnimationTime);
        });
        updateCounter()

    </script>

</body>

</html>
